#2016年自动化系 香菇滑稽大赛

- 编译条件：

  - Visual Studio 2012(VC11)（如果不想这么干，请ignore掉项目文件）
  - Opencv 2.4.10（必须）
  - 请自行编辑属性表文件并且放置到项目目录下（与.vcproj同目录），两个配置文件的名称分别为OpenCV_release_property.props和OpenCV_debug_property.props，这是写死在.vcproj里的（如果不想这么干，请ignore掉项目文件）

- 以下是规则书


#香菇滑稽 Version2 Update2

> 修订：wxk14\Du<br>
> 规则：Du <br>
> 鸣谢：Pierre ;Starlight 

# 游戏模式

【赛程慢慢来嘛】

- 积分赛~~天梯模式~~

  根据标准规则和标准地图进行 *一局比赛* 。标准地图是公开的。

  关于 *一局比赛* 的定义，参见本段最后。

- 初赛

  初赛的时候将根据标准规则和初赛特制的地图进行 *一轮比赛* ，前7名进入决赛（刨掉乱斗模式的胜利者之外的）

  关于 *一轮比赛* 的定义，参见本段最后。

- 乱斗模式

  每两周一次，采用特别制定的地图和特别制定的胜利条件和特殊规则，决出胜负。每个乱斗周期结束的时候，进行 *一轮比赛* ，前三名作为本届乱斗的优胜者保送进入决赛。【并且应该还有其他优惠】

  特制地图将在该轮次乱斗的前一周公布。

- 决赛

  决赛将采用标准规则和决赛特制的地图进行 *一轮比赛*。

- 一局比赛的定义

  一局比赛中，将由赛程规定数目的玩家参与比赛，获得初始资源，并且决出优胜者（或相对优胜者）。关于如何决出优胜者，参见 **游戏规则-胜利条件** 。

- 一轮比赛的定义

  一轮比赛将由若干局比赛组成。在第一局比赛中，所有玩家的出生点将获得等量的资源。从第二局比赛开始，上一局中的优胜者（或相对优胜者）获得上一局初始资源的1.5倍。持续此过程，直到有玩家的初始资源为原来资源的1.5^5倍，则此玩家获得优胜并从下一局游戏开始被剔除。持续此过程直到足够多的玩家（赛程规定数目的玩家）获得优胜。



# 游戏规则

##概述

战争模拟游戏

- 玩家消耗资源建立城市
- 城市对土地施加影响力以夺取土地主权
- 国家领土为之提供资源

##胜利条件
- 歼灭其他所有国家
- 限定回合后土地最/较多的国家
- 在乱斗模式中，第一个完成满足剧本特殊要求的国家

##土地与资源

- 地图尺寸是给定的，预计最大100*100
- 土地的主权
  - 土地主权有两种状态：中立，某国领土
  - 游戏开始时，除了出生点，所有土地都是中立的
  - 土地主权判定参见**城市与影响力**

- 土地的资源
  - 每块土地有不同的资源
  - 国家出生点上保证有资源（初始资源）
  - 每回合国家都会得到总领土资源和的资源量；而中立的土地资源直接流失
  - 国家可以保存自己资源以供不时之需
  - 【存的太多会有很严重的通货膨胀debuff 且 城市对附近的领土资源有加成，总之要打压一波流】
- 土地的地形
  - 每块土地有不同的地形
  - 地形有两个参数：攻击系数和防御系数，参见**城市与影响力**
- 土地的特殊效果
  - 乱斗规则特有
  - 将由剧本指明

##城市与影响力

- 城市的建立与发展
  - 游戏开始时，一个国家有一个出生点，且出生点上有一个等级1的城市。
  - 国家可耗费 k * c 的资源量，在本回合己方领土上建立一个k级的城市，或将自己某个城市的等级增加k级。也即，空地相当于0级城市。
  - 【你也可以在同盟国的领土内建立你自己的城市。】
    - 战术价值：在他国领土边境处英勇击敌夺得**自己**的领土。
    - 风险：一旦同盟被取消，你将被迫以很低的价格撤回这些没有建在本国领土上的城市；而且此时因为军通的问题，你新打出来的领土可能没有任何防御能力。
    - 如果同时在一块地里面有其他人的城市，这些城市是分开算的。也即，一块地上可以有分属于同盟不同AI的许多城市。
- 影响力
  - 城市将对周边土地产生影响力。在没有其他国家领土的情况下，影响力随城市等级递增，随城市距土地的距离递减。
    - TODO:【影响力函数的设计】
  - 在**军通**的前提下，己方城市对己方和同盟领土造成防御影响力；对相互战争中的国家领土或中立土地造成攻击影响力。
    - **军通**是指，影响力不能跨过非友方区域（包括中立区和敌占区）传递。
    - 如果我方领土被切断成了两部分，又没有合适的盟友能够提供连通的道路，则两个区域的防御力分别计算，无法累加。
  - 如果城市对某块地区的影响力超过了
    - 战术价值：将太弱的城市群清场，快速扩张，切断军通构成包围，紧急回连突破包围封锁
    - 风险：想要达到战略价值就必须快速投入大量资源；效果只会持续一回合，且后备军不足就很可能被反包围；如果己方边境附近已经塞满了城市，这个buff无计可施；
- 土地主权判定
  -以下称每个能对这块土地施加影响，且不控制这块土地的AI为一个攻击方AI；称控制这块土地的AI为防御方AI。
  -  每个回合，每个攻击方AI对这块土地施加（此AI对这块土地的影响力 *土地地形的攻击系数）的影响力；防御方AI对这块土地施加（此AI对这块土地的影响力 *土地地形的攻击系数）的影响力
  -  如果经过一回合之后，一个AI对于一块土地的影响力比其他每个AI对于这块土地的影响力都要高出至少X，那么从下回合开始，AI将会“控制”这块地，也即，享受这块地的资源获取和防御方地形修正。反之，这块地如果未被任何AI控制，则显示为中立。
  -  如果一个AI在一回合内瞬间控制了一块地（即从差X变为高X），则获得overrun（所谓“连破”）效果，即这块地视作对这个AI有军通，并且计算由于这块地有军通导致能够新的能够攻击到的土地上产生的影响力
     -  这个过程是可以一直持续下去直到无法继续扩张的，所以如果你在一个点处一次投入了大量城市，可能会一路overrun下去，导致下回合获得很大的一块新领土。~~大炸弹什么的，康神表示大喜び~~
     -  由于地形的存在，关键隘口被瞬间击破之后后面可能会因为无险可守而瞬间垮掉一大片。
     -  有些地形是不可通过的（防御系数无穷大），~~这时候你可能观察到明显的衍射现象,滑稽~~。
     -  ~~如果同时有两个攻击方丢大炸弹的话，你会观察到明显的干涉现象，滑稽~~。
  -  一个AI对于一块土地的影响力最多只能比其他AI高X。即，如果一块地的攻击方影响小于防御方影响，那么这块地在下回合将维持当前影响力状态不变（反之，这块地将至少变为中立，或者变为攻击方所属）
     - 如果领土的归属权从一个AI转移到另一个AI，则领土上的原AI城市被破坏。
  -  每个攻击方AI对这块土地的影响力只由自己造成；防御方AI对这块土地的影响力由自己以及自己战争中的盟友造成。关于"战争中的盟友"，参见**国家与外交**部分

##国家与外交

- 国际关系
  - 未发现：还没有发现的国家
    - 无视野；不侵犯；不联防；
  - 中立：观察到国家之后的默认状态
    - 有视野；不侵犯；不联防；
  - 停战：等于中立，但x回合内状态不会改变
    - 有视野；不侵犯；不联防； 
  - 同盟
    - 有视野；不侵犯；联防；
  - 战争
    - 无视野；侵犯；不联防；
- 外交态度
  - 包括三种：保持中立、默许同盟、战争
  - 各状态下可以采取的外交态度
    - 未发现
      - 外交态度强制为保持中立
    - 中立 / 停战
      - 默许同盟
        - 由对方外交态度决定，回合结束后的状态将是（括号内为对方对你的态度）
          - 同盟（默许同盟）
          - 中立（保持中立）
          - 战争（战争）
      - 保持中立(default)
        - 由对方外交态度决定，回合结束后的状态将是
          - 中立（保持中立，默许同盟）
          - 战争（战争）
      - 宣战（停战状态下，此态度将作为“继续中立”处理）
        - 回合结束时的状态将是
          - 战争
        - 【可以在战争的回合打出第一波攻击】
        - 从中立转为战争的这一回合（即宣战），被宣战的AI的所有同盟AI，如果与宣战AI处于中立状态，则同时自动与宣战AI进入战争状态。
    - 同盟
      - 继续同盟(即“默许同盟”，default)
        - 由对方外交态度决定，回合结束后的状态将是
          - 同盟（继续同盟）
          - 停战（解除同盟）
      - 解除同盟（即“保持中立”或“战争”）
        - 回合结束时的状态将是
          - 停战
    - 宣战
      - 继续战争(即“战争”，default)
        - 回合结束时的状态将是
          - 战争
      - 请求停战（包括“默许同盟”和“保持中立”）
        - 由对方外交态度决定，回合结束后的状态将是
          - 战争（继续战争）
          - 停战（请求停战）

- 战争中的盟友
  - 如果两个AI处于同盟，并且对同一个AI宣战，那么这两个AI被视作“战争中的盟友”。在战争中，防御时影响力叠加计算。

##回合时序

- （第一回合特有）选择出生点
- 建造
  - 在自己或同盟国家，建立或升级城市
- 外交
  - 更新国家的外交状态
- 战争
  - 计算全图的影响力变更
  - 如果发生了overrun现象，则递归计算全图的影响力变更直到不再发生overrun。
- 检查胜负
